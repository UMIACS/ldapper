version: '3'

services:
    openldap:
        image: osixia/openldap:1.2.2
        environment:
            LDAP_ORGANISATION: "Acme Corporation"
            LDAP_DOMAIN: acme.org
            LDAP_ADMIN_PASSWORD: JonSn0w
        command: --copy-service
        ports:
            - 389:389
    phpldapadmin:
        image: osixia/phpldapadmin
        environment:
            PHPLDAPADMIN_LDAP_HOSTS: openldap
        links:
            - openldap
        depends_on:
            - openldap
        ports:
            - 6443:443

    ldap-seed:
        image: osixia/openldap:1.2.2
        volumes:
            - ./config:/tmp/config
        links:
            - openldap
        entrypoint: sh -c 'sleep 6 && ldapadd -h openldap -c -D cn=admin,dc=acme,dc=org -w JonSn0w -f /tmp/config/acme.ldif'
